%  article.tex (Version 3.3, released 19 January 2008)
%  Article to demonstrate format for SPIE Proceedings
%  Special instructions are included in this file after the
%  symbol %>>>>
%  Numerous commands are commented out, but included to show how
%  to effect various options, e.g., to print page numbers, etc.
%  This LaTeX source file is composed for LaTeX2e.

%  The following commands have been added in the SPIE class 
%  file (spie.cls) and will not be understood in other classes:
%  \supit{}, \authorinfo{}, \skiplinehalf, \keywords{}
%  The bibliography style file is called spiebib.bst, 
%  which replaces the standard style unstr.bst.  

\documentclass[]{spie}  %>>> use for US letter paper
%%\documentclass[a4paper]{spie}  %>>> use this instead for A4 paper
%%\documentclass[nocompress]{spie}  %>>> to avoid compression of citations
%% \addtolength{\voffset}{9mm}   %>>> moves text field down
%% \renewcommand{\baselinestretch}{1.65}   %>>> 1.65 for double spacing, 1.25 for 1.5 spacing 
%  The following command loads a graphics package to include images 
%  in the document. It may be necessary to specify a DVI driver option,
%  e.g., [dvips], but that may be inappropriate for some LaTeX 
%  installations. 
\usepackage[]{graphicx}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{wrapfig}

\graphicspath{{images/}}

\title{SVA: Shape variation analyzer} 

%>>>> The author is responsible for formatting the 
%  author list and their institutions.  Use  \skiplinehalf 
%  to separate author list from addresses and between each address.
%  The correspondence between each author and his/her address
%  can be indicated with a superscript in italics, 
%  which is easily obtained with \supit{}.

\author{Priscille de Dumast\supit{a}, Clement Mirabel\supit{a}, Beatriz Paniagua\supit{b}, Marilia Yatabe\supit{a}, Antonio Ruellas\supit{a},
Martin Styner\supit{c}, Lucia Cevidanes\supit{a}, Juan C. Prieto\supit{c}
\skiplinehalf
\supit{a}University of Michigan, Ann Arbor, United States \\
\supit{b}Kitware, Carrboro, United States; \\
\supit{c}University of North Carolina, Chapel Hill, United States;
}

%>>>> Further information about the authors, other than their 
%  institution and addresses, should be included as a footnote, 
%  which is facilitated by the \authorinfo{} command.

\authorinfo{Further author information: (Send correspondence to A.A.A.)\\A.A.A.: E-mail: aaa@tbk2.edu\\ E-mail: bba@cmp.com, Telephone: +33 (0)1 98 76 54 32}
%%>>>> when using amstex, you need to use @@ instead of @
 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%>>>> uncomment following for page numbers
% \pagestyle{plain}    
%>>>> uncomment following to start page numbering at 301 
%\setcounter{page}{301} 
 
  \begin{document} 
  \maketitle 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\begin{abstract}

Temporo-mandibular osteo arthritis (TMJ OA)
is characterized by progressive cartilage degradation and subchondral bone remodeling. The causes of this pathology remain 
unclear. Current research efforts are concentrated in finding new biomarkers
that will help us understand disease progression and ultimately improve the treatment of the disease. 
In this work, we present Shape Variation Analyzer (SVA), the goal is to develop a noninvasive technique to provide information about shape changes in TMJ OA. 
SVA uses neural networks to classify morphological variations of 3D models of the mandibular condyle. 
The shape features used for training include normal vectors, curvature and distances to average models of the condyles. 
The selected features are purely geometric and are shown to favor the classification task into 8 groups 
generated by consensus between two clinician experts. 
With this new approach, we were able to accurately classify 3D models of condyles. 
In this paper, we present the methods used and the results obtained with this new tool. 

\end{abstract}

%>>>> Include a list of keywords after the abstract 

\keywords{Temporo-mandibular osteo arthritis, deep learning, classification, artificial intelligence}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUCTION}
\label{sec:intro}  % \label{} allows reference to this section

Osteoarthritis (OA), the most prevalent arthritis worldwide, is associated with significant pain and disability and affects 15\% of adults at any given time \cite{kalladka2014temporomandibular}. 

The complex pathogenesis of temporomandibular joint (TMJ) OA remains unclear to this day, and understanding its progression challenges experts given the different morphological patterns of bone resorption and formation observed in its various stages. The disease may evolve into repair and morphological adaptation, but also into aggressive bone destruction and functional impairment. 
Patients with OA present a variety of symptoms including pain, limited jaw movement, grinding, clicking, 
and deviation on opening.
Figure \ref{fig:mandibular} shows the mandibular condyles. 
\begin{wrapfigure}{r}{0.3\textwidth}
    \centering
    \includegraphics[width=0.2\textwidth]{mandibular-condyles.png}
    \caption{Mandibular condyles in red.}
    \label{fig:mandibular}
\end{wrapfigure}
There is no method to quantify morphology for early diagnosis, assessment of disease progression and treatment effects. 
The symptoms are different from patient to patient, i.e., TMJ OA may be in a quiet state until is set of by an array 
of events or it may be painful from the start. However, recent work quantifying condylar morphology revealed 
differences between OA and asymptomatic condyles\cite{cevidanes2010quantification}.

The goal of this work is to develop a noninvasive technique to provide information about bony changes and disease changing in TMJ OA, using Shape Analysis. 
Given the complexity of such heterogeneous conditions and current clinical, biological and imaging data in arthritis of the temporomandibular joint, there is a compelling need for more efficient software tools to facilitate these analyses. To answer this challenge, we developed Shape Variation Analyzer (SVA) using a neural network to classify morphological variations using 3D models of the mandibular condyle. 

The development of this tool did not consist only on building and training a neural network but also
the pre-processing steps to prepare the data, which include generating 3D models of the condyles \cite{PANIAGUA2011345}, improve shape correspondence \cite{lyu2013group}, and extract shape features from the 3D models.

\section{MATERIALS}

The study group consists of 259 TMJ joints (154 TMJ OA, 105 asymptomatic controls), obtained from Cone Beam Computed Tomography (CBCT) scans (i-CAT Next Generation, 120 kV, 18.66 mA). TMJ OA joints were subdivided, by consensus between 2 clinicians, into 7 subgroups based in morphological variability, compared to the average control morphology.
Table \ref{tab:subjects} shows how the TMJ OA groups were subdivided.

\begin{table}[]
\caption{Subdivision of TMJ OA subjects. 
C: Control, CN: Close to Normal, OG: Overgrowth, D[1-5]: Degeneration}
\label{tab:subjects}
\begin{center}   
\begin{tabular}{|c|c|c|c|c|c|c|c|c|}
\hline
 & 00 C & 01 CN & 02 OG & 03 D1 & 04 D2 & 05 D3 & 06 D4 & 07 D5  \\
\hline
Number of samples & 105 & 33 & 9 & 28 & 31 & 37 & 20 & 5 \\
\hline
\end{tabular}
\end{center}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{METHODS} 

\subsection{Model creation}

The CBCT images are segmented using a semi-automated method in ITK-SNAP\cite{py06nimg}. The software allows manual editing to clean the segmentation. Figure \ref{fig:itkSnapCondyle} shows a screen-shot of the application with different orthogonal slices
of the image.
\begin{figure}
\centering 
    \label{fig:itkSnapCondyle}
    \includegraphics[width=0.25\textwidth]{ITKSnapCondyles.png}
    \caption{Manual segmentation of Condyles using ITK-SNAP}
\end{figure} 
% Figure \ref{fig:modelMaker} shows the generated 3D model of the condyle. 
Using EasyClip (a module included in 3DSlicer), the condylar models are simultaneously cropped to define the condylar region of interest. The cropped segmentation maps are used to generated regular tessellations.
% \begin{figure}
% \centering 
%     \label{fig:modelMaker}
%     \includegraphics[width=0.25\textwidth]{ModelMaker-FullView.png}
%     \caption{The 3D model is used to define the condylar region of interest. Using the module EasyClip, the condylar models are simultaneously cropped. The cropped segmentation maps are used as input for SPHARM-PDM.}
% \end{figure} 
Spherical harmonics representation point distributed models (SPHARM-PDM)\cite{styner2006framework} is used to generate a mesh with 1002 points, via spherical mapping and spherical parametrization of the input segmentation maps. 
SPHARM-PDM generates a regular mesh, as show on figure \ref{fig:result1_bi}.
\begin{figure}
\centering 
    \subfigure[]{\label{fig:result1_bi}\includegraphics[width=0.25\textwidth]{MeshModelMaker-Wireframe.png}}
    \subfigure[]{\label{fig:result2_bi}\includegraphics[width=0.25\textwidth]{MeshAfterSpharm.png}}
    \caption{Figure (a) shows a condylar model generated }
    \label{fig:result_bi}
\end{figure} 
After the models have the same number of points and a regular mesh, we proceed to place landmarks in the 3D models. 
The landmarks are placed in homologous regions for all individuals. Figure \ref{fig:registration} shows a condyle 
with the landmarks placed on the surface. 
\begin{figure}
\centering 
    \label{fig:registration}
    \includegraphics[width=0.2\textwidth]{LandmarksCondyle.png}
    \caption{Landmarks in red, displayed in the surface of a condyle 3D model.}
\end{figure}
These landmarks are used to generate a tessellation with correspondent points 
employing a group-wise registration method\cite{lyu2013group}.
Figure \ref{fig:groups} shows the condylar models aligned where regions in the 3D model correspond across the population.
\begin{figure}
\centering 
    \subfigure[]{\label{fig:RigidAlignmentBefore}\includegraphics[width=0.5\textwidth]{RigidAlignment-before.png}}
    \subfigure[]{\label{fig:RigidAlignmentAfter}\includegraphics[width=0.5\textwidth]{RigidAlignment-after.png}}
    \caption{Group-wise correspondence (GROUPS). Figure (a) shows the models generated by SPHARM-PDM. The spherical parameterization produced by SPHARM and the landmarks are used to generate 3D models that have correspondent points across subjects. The rainbow color map in the 3D models encode the location. Figure (b) shows the 3D models after GROUPS.}
    \label{fig:groups}
\end{figure}

\subsection{Feature extraction}

Using the aligned 3D models, an average model is created for each group described in Table \ref{tab:subjects}.
The features that led to higher accuracy in classification include 
the normal vectors, mean curvature of the surface, and the distances to the average meshes. 
In general, the input data for our network has shape  $N * n_{pt} * n_{feat}$ where $N$ is the batch size during training, 
$n_{pt} = 1002$ and $n_{feat} = 11$. These features do not include any information about position and are purely geometric.

Table \ref{tab:subjects} shows the 8 groups of morphological variability. In total there are 268 condylar models. 
The control group had 105 models, whereas the smallest group (D5) contained only 5 models. 
In order to train our classifier, it was necessary to have a balance data set per class, i.e., each group should have 
the same number of samples. To accomplish this objective, noise was added to randomly selected samples for each group. 
This newly generated samples are added to each group. 

\section{RESULTS}

The neural network has 1 hidden layer, was trained 2001 iterations and 50 epochs. 
The SVA  performance is  shown in the confusion matrix \ref{tab:confusion}, 
where each column represents the instances in the SVA classification group,
while each row represents the group instances as assessed by the consensus between two clinician experts. Agreement between the clinician consensus and the SVA classification are located in the main diagonal of the table. 
Cells adjacent to the main diagonal (1 diagonal 
to the right and 1 diagonal to the left) indicate the classification of the degree of degeneration was within 1 group difference. The main and adjacent diagonals include 91\% of the testing dataset. 
The cells outside the 3 middle diagonals show that 3 out of 34 condyles were classified with 2 or more groups difference. 

\begin{table}[]
\centering
\caption{Confusion matrix: columns show the SVA classification of condylar morphology; rows show the clinician experts consensus classification. The main diagonal cells show when the group was classified by the SVA exactly the same as the clinicians. The cells in 1 diagonal to the right and 1 diagonal to the left show number of condyles where the prediction differed from clinicians by only one group and still indicates an acceptable estimate of severity/risk level of disease staging. A challenge is that clinician expert assessment is limited by their visual perception of the 3D morphology. Note that as the testing dataset is from patients with less than 5 years of  diagnosis of the disease, SVA  did not classify any  group 4 or  5 of  more  advanced disease stag in the testing sample, as expected.in such disease  condition that  the degeneration progresses in a chronic process through many years. }
\label{tab:confusion}
\begin{tabular}{lllllll}
ClinE \textbackslash  SVA & 00 & 01 & 02 & 03  & 04 & 05 \\
00                       & 1 & 0 & 0 & 0  & 0 & 0 \\
01                       & 7 & 1 & 0 & 0  & 0 & 0 \\
02                       & 2 & 2 & 1 & 4  & 0 & 0 \\
03                       & 1 & 0 & 1 & 10 & 0 & 0 \\
04                       & 0 & 0 & 0 & 2  & 2 & 0 \\
05                       & 0 & 0 & 0 & 0  & 0 & 0
\end{tabular}
\end{table}

\section{CONCLUSION}

SVA is new tool to analyze shape variation using deep neural networks. 
The results presented here indicate that using shape features only favors the classification task, i.e., 
we do not include any information about position or orientation of the model. 
This classification approach seems promising, as it may help us increase our understanding about 
shape changes that TMJ OA patients undergo during the course of the disease. 
The source code repository is available at \url{https://github.com/DCBIA-OrthoLab/ShapeVariationAnalyzer}

Future work will aim to create a larger data set for training. 
One of the challenges will be to generate shapes that are representative of each group. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% References %%%%%
\bibliography{report}   %>>>> bibliography data in report.bib
\bibliographystyle{spiebib}   %>>>> makes bibtex use spiebib.bst

\end{document} 
